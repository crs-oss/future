<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">

<title>å†™ç»™äº”å¹´åçš„è‡ªå·±</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family: "Raleway", sans-serif;}
html,body{height:100%;font-family:"Georgia","Noto Serif SC",serif;background:radial-gradient(circle at top,#1b2735,#05070d 70%);color:#f2f2f2;overflow-x:hidden;}
body.morning{background:radial-gradient(circle at top,#1b2735,#05070d 70%);color:#333;transition:background 6s,color 6s;}
.stars{position:fixed; inset:0; z-index:0; pointer-events:none;}
.star{position:absolute;border-radius:50%;background:white;box-shadow:0 0 8px rgba(255,255,255,.9);animation:starFloat linear infinite,starTwinkle ease-in-out infinite;}
@keyframes starFloat{from{transform:translateY(110vh);}to{transform:translateY(-10vh);}}
@keyframes starTwinkle{0%,100%{opacity:.5;}50%{opacity:1;}}
.meteor{position:absolute;width:140px;height:2px;background:linear-gradient(90deg,white,transparent);transform:rotate(-45deg);animation:meteor 1.2s linear forwards;}
@keyframes meteor{to{transform:translate(-300px,300px) rotate(-45deg);opacity:0;}}
body.morning .stars{opacity:0;transition:opacity 6s;}
section{min-height:100vh; display:flex; align-items:center; justify-content:center; padding:40px 20px; text-align:center; position:relative; z-index:1;}
h1{font-size:clamp(1.6em,5vw,2.4em); line-height:1.6;}
button{margin-top:20px; padding:10px 28px; border-radius:30px; border:1px solid rgba(255,255,255,.6); background:transparent; color:inherit; cursor:pointer;}
textarea{width:100%; min-height:100px; border-radius:12px; border:none; padding:12px; font-family:inherit; margin-top:10px; max-width:500px; width:100%;display:block;margin:10px auto;}
.lock{opacity:.75; font-size:.95em;}
#letter{line-height:2;}
.paragraph{margin-bottom:24px; opacity:0; color:#fff;
  transform:translateY(30px);
  transition:all 1.6s ease;
  margin-bottom:36px;}
  .paragraph.show{
  opacity:1;
  transform:translateY(0);
}
#editorSection{display:none;}
#savedNotice{margin-top:10px; color:lightgreen;}


/* ===== æ˜Ÿç©º ===== */
.stars{
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none;
}

.star{
  position:absolute;
  border-radius:50%;
  background:white;
  box-shadow:0 0 8px rgba(255,255,255,.9);
  animation:starFloat linear infinite,starTwinkle ease-in-out infinite;
}

@keyframes starFloat{
  from{transform:translateY(110vh);}
  to{transform:translateY(-10vh);}
}

@keyframes starTwinkle{
  0%,100%{opacity:.5;}
  50%{opacity:1;}
}

/* æµæ˜Ÿ */
.meteor{
  position:absolute;
  width:140px;
  height:2px;
  background:linear-gradient(90deg,white,transparent);
  transform:rotate(-45deg);
  animation:meteor 1.2s linear forwards;
}

@keyframes meteor{
  to{transform:translate(-300px,300px) rotate(-45deg);opacity:0;}
}


</style>
</head>
<body>

<audio id="bgm" autoplay loop>
<source src="mayday.mp3" type="audio/mpeg"> 

</audio>


<div class="stars"></div>

<!-- ç¼–è¾‘ç•Œé¢ -->
<section id="editorSection">
  <div>
    <h2>ğŸ“ å†™ç»™äº”å¹´åçš„è‡ªå·±</h2>
    <p>å†™ä¸‹ä½ æƒ³ç»™æœªæ¥è‡ªå·±çš„è¯ï¼š</p>
    <textarea id="pastText" placeholder="æ­£æ–‡å†…å®¹"></textarea>
    <textarea id="lockTextInput" placeholder="é”å®šå†…å®¹ï¼Œæœªæ¥è§£é”æ˜¾ç¤º"></textarea><br>
    <button id="saveBtn">ğŸ’¾ ä¿å­˜ä¿¡ä»¶</button>
  <button class="clearBtn">ğŸ—‘ï¸ æ¸…é™¤å·²ä¿å­˜å†…å®¹</button>
    <p id="savedNotice"></p>
  </div>
</section>

<!-- å°é¢ / æ‰“å¼€æŒ‰é’® -->
<section id="intro" style="display:none;">
  <div>
    <h1 id="typing">â³ æ‰“å¼€æœªæ¥çš„ä¿¡ä»¶</h1>
    <button id="openBtn">âœ‰ï¸ æ‰“å¼€ä¿¡ä»¶</button>
<button class="clearBtn">ğŸ—‘ï¸ æ¸…é™¤å·²ä¿å­˜å†…å®¹</button>
  </div>
</section>

<!-- ä¿¡ä»¶æ˜¾ç¤º -->
<section id="letterSection" style="display:none;">
  <div id="letter">
    <div class="paragraph">äº²çˆ±çš„äº”å¹´åçš„è‡ªå·±ï¼š</div>
    <div class="paragraph" id="pastDisplay"></div>
    <div class="paragraph lock" id="lockDisplay"></div>
    <div id="replyBox" style="display:none !important;">
      <p>âœï¸ ç»™äº”å¹´å‰çš„è‡ªå·±ç•™è¨€</p>
      <textarea id="reply"></textarea>
      <button onclick="saveReply()">ä¿å­˜</button>
      <div id="savedReply"></div>
    </div>
  </div>
</section>

<script>

/* æ˜Ÿç©º */
const starBox=document.querySelector(".stars");
for(let i=0;i<160;i++){
  const s=document.createElement("div");
  s.className="star";
  const size=Math.random()*2+1;
  s.style.width=s.style.height=size+"px";
  s.style.left=Math.random()*100+"%";
  s.style.top=Math.random()*100+"%";
  s.style.animationDuration=
    `${20+Math.random()*30}s, ${3+Math.random()*3}s`;
  starBox.appendChild(s);
}


setInterval(()=>{
  const m=document.createElement("div");
  m.className="meteor";
  m.style.left=Math.random()*100+"%";
  m.style.top=Math.random()*40+"%";
  starBox.appendChild(m);
  setTimeout(()=>m.remove(),1200);
},8000);

// æ—¥æœŸæ§åˆ¶
const target = new Date("2031-01-14");
const now = new Date();
const locked = now < target;

// è¯»å–ä¿å­˜å†…å®¹
const savedPast = localStorage.getItem("pastText");
const savedLock = localStorage.getItem("lockText");
const savedReply = localStorage.getItem("reply");

// é¡µé¢å…ƒç´ 
const editor = document.getElementById("editorSection");
const intro = document.getElementById("intro");
const letterSection = document.getElementById("letterSection");

// é¡µé¢åˆå§‹æ˜¾ç¤ºé€»è¾‘
if(!savedPast && !savedLock){
  editor.style.display = "block"; // æ˜¾ç¤ºç¼–è¾‘ç•Œé¢
} else {
  intro.style.display = "block"; // æ˜¾ç¤ºå°é¢
}

// ä¿å­˜ä¿¡ä»¶
document.getElementById("saveBtn").onclick = () => {
  const past = document.getElementById("pastText").value;
  const lock = document.getElementById("lockTextInput").value;
  if(!past && !lock) return alert("è¯·è‡³å°‘è¾“å…¥ä¸€äº›å†…å®¹ï¼");
  localStorage.setItem("pastText", past);
  localStorage.setItem("lockText", lock);
  document.getElementById("savedNotice").innerText="âœ… å·²ä¿å­˜ï¼Œç¼–è¾‘ç•Œé¢å…³é—­ã€‚";
  setTimeout(()=>{
    editor.style.display = "none";
    intro.style.display = "block";
  }, 500);
};

// æ¸…é™¤å·²ä¿å­˜å†…å®¹
document.querySelectorAll(".clearBtn").forEach(btn => {
  btn.onclick = () => {
    localStorage.removeItem("pastText");
    localStorage.removeItem("lockText");
    localStorage.removeItem("reply");
    document.getElementById("pastText").value = "";
    document.getElementById("lockTextInput").value = "";
    document.getElementById("savedNotice").innerText = "ğŸ—‘ï¸ å·²æ¸…é™¤ä¿å­˜å†…å®¹ï¼Œå¯é‡æ–°ç¼–è¾‘ã€‚";
    // åˆ‡å›ç¼–è¾‘ç•Œé¢
    editor.style.display = "block";
    intro.style.display = "none";
    letterSection.style.display = "none";
  }
});



// æ‰“å¼€ä¿¡ä»¶
document.getElementById("openBtn").onclick = () => {
  intro.style.display = "none";
  letterSection.style.display = "block";
  
  
  
  document.querySelectorAll(".paragraph")
    .forEach((p,i)=>setTimeout(()=>p.classList.add("show"),i*1200));
	
	

  // æ­£æ–‡éšæ—¶æ˜¾ç¤º
  document.getElementById("pastDisplay").innerText = localStorage.getItem("pastText") || "";

  const lockDisplay = document.getElementById("lockDisplay");

  if(locked){
    // æ˜¾ç¤ºæœªè§£é”æç¤º
    lockDisplay.innerHTML = "ğŸ•°ï¸ å†…å®¹å°šæœªè§£é”<br><span id='countdown'></span>";

    // å€’è®¡æ—¶
    const countdownSpan = document.getElementById("countdown");

    function updateCountdown() {
      const now = new Date();
      const diff = target - now; // æ¯«ç§’
      if(diff <= 0){
        // åˆ°æ—¶é—´äº†
        lockDisplay.innerText = localStorage.getItem("lockText") || "";
        document.body.classList.add("morning");
       // document.getElementById("replyBox").style.display = "block";
        if(savedReply) document.getElementById("savedReply").innerText = savedReply;
        clearInterval(timer);
        return;
      }
      const days = Math.floor(diff / 86400000);
      const hours = Math.floor((diff % 86400000) / 3600000);
      const minutes = Math.floor((diff % 3600000) / 60000);
      const seconds = Math.floor((diff % 60000) / 1000);
      countdownSpan.innerText = `è¿˜å‰© ${days} å¤© ${hours} å°æ—¶ ${minutes} åˆ† ${seconds} ç§’`;
    }

    updateCountdown(); // ç«‹å³æ˜¾ç¤ºä¸€æ¬¡
    const timer = setInterval(updateCountdown, 1000);

  } else {
    // å·²åˆ°è§£é”æ—¶é—´
    lockDisplay.innerText = localStorage.getItem("lockText") || "";
    document.body.classList.add("morning");
   // document.getElementById("replyBox").style.display = "block";
    if(savedReply) document.getElementById("savedReply").innerText = savedReply;
  }
};


// ç•™è¨€ä¿å­˜
function saveReply(){
  const val = document.getElementById("reply").value;
  localStorage.setItem("reply", val);
  document.getElementById("savedReply").innerText="âœ… å·²ä¿å­˜ã€‚";
}
</script>


</body>
</html>


